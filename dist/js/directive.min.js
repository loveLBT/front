BGJZ_App.directive("myLaydate",function(){return{restrict:"E",replace:!0,scope:{myName:"@",myTime:"=",myForm:"="},controller:["$scope",function(e){e.required=!0}],template:"<input type='text' name='{{myName}}' class='form-control form-laydate' placeholder='请选择日期' readonly='readonly' ng-model='classhour.checkDate' ng-required='required' />",link:function(e,t,i){t.on("click",function(){laydate({min:laydate.now(),choose:function(t){e.$apply(function(){e.myTime=t,e.required=!1,e.myForm.$valid=!0})}})})}}}),BGJZ_App.directive("myMedia",function(){return{restrict:"AE",replace:!0,template:"<a href='javascript:;'>播放</a>",link:function(e,t,i){t.on("click",function(){if($(".media-wrap").length)$(".media-wrap").show();else{$("body").append("<div class='media-wrap'><div id='mediaBox' class='media-box'></div><div class='media-mask'></div></div>");var e=$("#mediaBox");e.css({position:"absolute",top:"50%",left:"50%","z-index":"99",margin:"-250px 0 0 -400px"})}var t={p:1,f:"http://movie.ks.js.cn/flv/other/1_0.flv",c:0},i={bgcolor:"#FFF",allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"},a=["http://movie.ks.js.cn/flv/other/1_0.mp4->video/mp4"];CKobject.embed("../dist/js/ckplayer/ckplayer.swf","mediaBox","ckplayer_mediaBox","800","500",!1,t,a,i);var n=$(".media-mask");n.click(function(){$(".media-wrap").fadeOut()})})}}});var mainDirectives=angular.module("mainDirectives",[]);mainDirectives.directive("login",["$timeout","$window","$state","loginService","tipService",function(e,t,i,a,n){return{restrict:"AE",replace:!0,scope:{data:"=",tip:"="},template:"<a class='btn btn-primary btn-block form-control'>登录</a>",link:function(e,r,c){r.bind("click",function(){a.sub(e.data).then(function(e){t.sessionStorage.token=e.accessToken,i.go("list.store")},function(e){console.log(e),n.setMessage("登入失败！"+e.data,"danger")})})}}}]),mainDirectives.directive("loginout",["$window","$state","globaleService",function(e,t,i){return{restrict:"AE",replace:!0,scope:{},template:"<a>退出</a>",link:function(a,n,r){a.settings={method:"delete",url:"/admin/login",data:""},n.bind("click",function(){i.ajaxData(a.settings).then(function(i){e.sessionStorage.token="",t.go("login")},function(e){tipService.setMessage("成功退出！","success")})})}}}]),mainDirectives.directive("disable",["$location","globaleService","tipService",function(e,t,i){return{restrict:"AE",replace:!0,scope:{setting1:"=",setting2:"=",stateBtn1:"@",stateBtn2:"@",url1:"@",url2:"@",state:"@",refresh:"&"},template:"<span><a class='btn btn-danger' ng-if='state==1||state==3'>{{stateBtn1}}</a><a class='btn btn-danger' ng-if='state==2'>{{stateBtn2}}</a></span>",link:function(e,a,n){a.bind("click",function(a){e.setting1.url=e.url1,e.setting2.url=e.url2,1==e.state?e.setting=e.setting1:2==e.state?e.setting=e.setting2:3==e.state&&(e.setting=e.setting1),t.ajaxData(e.setting).then(function(t){e.refresh(),i.setMessage("状态修改成功","success")},function(e){i.setMessage("状态修改出错","danger")})})}}}]),mainDirectives.directive("sure",["$timeout","$stateParams","globaleService","sureService","tipService","dateService",function(e,t,i,a,n,r){return{restrict:"AE",replace:!0,scope:{data:"=",urlData:"="},template:"<button class='btn btn-success btn-block'>确定</button>",link:function(e,c,o){var s={},l=function(){$.each(e.data,function(e,t){if(""==t.inputModel)return"password"==t.labelFor||"confirm"==t.labelFor?!0:(n.setMessage(t.labelName+"不能为空！","danger"),s={},!1);switch(t.dataType){case"int":"datefilter"!=t.filter?s[t.labelFor]=parseInt(t.inputModel):s[t.labelFor]=parseInt(r.getUnix(t.inputModel));break;case"float":s[t.labelFor]=parseFloat(t.inputModel);break;default:s[t.labelFor]=t.inputModel}})},d=function(){var t={method:"post",url:e.urlData.postUrl,data:s};i.ajaxData(t).then(function(e){history.back()},function(e){n.setMessage("添加出错！","danger")})},u=function(){var t={method:"put",url:e.urlData.putUrl,data:s};i.ajaxData(t).then(function(e){history.back()},function(e){n.setMessage("更改出错！","danger")})},p=function(){0==t.id?d():u()},f=function(){s.password==s.confirm?p():n.setMessage("两次输入的密码不一致","danger")},m=function(){a.isEmptyObject(s)||(a.hasPwd(s)?f():p())};c.bind("click",function(){l(),m()})}}}]),mainDirectives.directive("fileread",["globaleService","tipService","loadingService",function(e,t,i){return{restrict:"AE",replace:!0,scope:{model:"="},template:"<div class='col-sm-12'><input class='form-control fileShow' type='text' ng-model='model' /><input class='form-control fileHide' type='file' /></div>",link:function(a,n,r){a.fileSetting={method:"post",url:"/admin/upload",data:""},n.bind("change",function(n){i.setLoading(),a.$apply(function(){e.upload(n.target.files[0],"/admin/upload").then(function(e){t.setMessage("文件上传成功","success"),a.model=e.url},function(e){t.setMessage("文件上传失败","danger")})})})}}}]),mainDirectives.directive("alertBar",function(){return{restrict:"AE",replace:!0,scope:{message:"=",type:"=",state:"="},templateUrl:"global/alertBar.html",link:function(e,t,i){var a=function(e){e?$(t).slideDown():$(t).slideUp()};e.message||$(t).css({display:"none"}),e.$watch("state",function(e,t){a(e)})}}}),mainDirectives.directive("loadingBar",function(){return{restrict:"AE",replace:!0,scope:{},templateUrl:"global/loadingBar.html",link:function(e,t,i){}}}),mainDirectives.directive("date",function(){return{restrict:"AE",replace:!0,scope:{date:"="},link:function(e,t,i){t.bind("click",function(){laydate({min:laydate.now(),choose:function(t){e.$apply(function(){e.date=t})}})})}}}),mainDirectives.directive("pageBar",function(){return{restrict:"AE",replace:!0,scope:{count:"=",data:"=",refresh:"&"},template:"<div id='page-selection'></div>",link:function(e,t,i){e.$watch("count",function(t,i){void 0!=t&&$("#page-selection").bootpag({total:Math.ceil(t/e.data.size),page:e.data.page+1}).on("page",function(t,i){e.data.page=i-1,e.refresh()})})}}});